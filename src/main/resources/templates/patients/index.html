<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Пациенты</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="w3-container">

<div class="w3-bar w3-border w3-light-grey w3-card-4">
    <a th:href="@{/home}" class="w3-bar-item w3-button"><i class="fa fa-home"></i></a>
    <span class="w3-bar-item w3-dark-gray">Пациенты</span>
    <a href="" class="w3-bar-item w3-button">Опросы</a>
    <a href="" class="w3-bar-item w3-button">Диагнозы</a>
    <a class="w3-bar-item w3-button w3-right w3-red" sec:authorize="isAuthenticated()" th:href="@{/logout}"><i
            class=" fa fa-sign-out"></i></a>
    <a class="w3-bar-item w3-button w3-right w3-green" sec:authorize="!isAuthenticated()" th:href="@{/home}"><i
            class=" fa fa-sign-in"></i></a>
    <span sec:authorize="isAuthenticated()" class="w3-bar-item w3-right">Пользователь: <span
            sec:authentication="principal.username"></span></span>
</div>

<h2 th:if="${param.error}" class="w3-container w3-card-4 w3-red w3-margin-top w3-padding">
    Недопустимые данные пациента.
</h2>

<div class="w3-container w3-dark-gray w3-margin-top w3-card-4">
    <h1>Пациенты</h1>
</div>

<div th:if="${lastUpdated != null}" sec:authorize="hasRole('ROLE_DOCTOR')" class="w3-container w3-dark-gray w3-padding w3-card-4">
    <span>Последний изменённый: <span th:text="${lastUpdated.getFullName()}"></span> (<span
            th:text="${lastUpdated.updatedAt}"></span>)</span>
</div>

<span th:each="i: ${#numbers.sequence(1, totalPages)}">
    <a th:if="${pageNumber != i}"
       th:href="@{/patients(fullName=${fullName}, minAge=${minAge}, maxAge=${maxAge}, pageNumber=${i}, gender=${gender})}">[[${i}]]</a>
    <span th:unless="${pageNumber != i}">[[${i}]]</span>
</span>

<table class="w3-table w3-striped w3-card-4 ">
    <thead>
    <tr class="w3-gray">
        <th sec:authorize="hasRole('ROLE_ADMIN')">ID</th>
        <th>Фамилия</th>
        <th>Имя</th>
        <th>Отчество</th>
        <th>Пол</th>
        <th>Дата рождения</th>
        <th>Возраст</th>
        <th class="w3-center" style="width: 150px">Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="patient : ${patients}">
        <td sec:authorize="hasRole('ROLE_ADMIN')" th:text="${patient.patientId}"></td>
        <td th:text="${patient.lastName}"></td>
        <td th:text="${patient.firstName}"></td>
        <td th:text="${patient.patronymic}"></td>
        <td th:text="${patient.gender}"></td>
        <td th:text="${patient.birthDate}"></td>
        <td th:text="${patient.getAge()}"></td>
        <td class="w3-row">
            <form class="w3-col s6" th:method="get" th:action="@{/patients/add}">
                <input type="hidden" th:name="patientId" th:value="${patient.patientId}"/>
                <button class="w3-button w3-dark-gray w3-margin-left" type="submit"><i class="fa fa-edit"></i></button>
            </form>
            <form sec:authorize="hasRole('ROLE_ADMIN')" class="w3-col s6" th:method="post"
                  th:action="@{/patients/delete/{id}(id=${patient.patientId})}">
                <button class="w3-button w3-red w3-margin-left" type="submit"><i class="fa fa-trash"></i></button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<div class="w3-container w3-dark-gray w3-card-4 w3-padding-16">
    <span class="w3-large" th:text="${'Всего пациентов ' + totalItems}"></span>
    <a th:href="@{/patients/add}" class="w3-button w3-right w3-green">Добавить</a>
</div>

<form th:action="@{/patients}" method="get" class="w3-container w3-card-4 w3-light-grey w3-margin-top">
    <h3>Фильтры</h3>

    <div class="w3-row-padding">
        <div class="w3-col s3">
            <label>ФИО</label>
            <input class="w3-input w3-border w3-round" type="text" name="fullName"
                   placeholder="Любые символы, содержащиеся в ФИО"
                   th:value="${fullName}">
        </div>
        <div class="w3-col s3">
            <label>Возраст больше чем</label>
            <input class="w3-input w3-border w3-round" type="number" name="minAge" th:placeholder="${minPatientAge}"
                   th:value="${minAge}">
        </div>
        <div class="w3-col s3">
            <label>Возраст меньше чем</label>
            <input class="w3-input w3-border w3-round" type="number" name="maxAge" th:placeholder="${maxPatientAge}"
                   th:value="${maxAge}">
        </div>
        <div class="w3-col s3">
            <label>Пол</label>
            <select class="w3-select w3-border w3-round" name="gender">
                <option value="" disabled selected>Выберите пол</option>
                <option th:selected="${#strings.equalsIgnoreCase(gender, 'М')}" th:value="М">М</option>
                <option th:selected="${#strings.equalsIgnoreCase(gender, 'Ж')}" th:value="Ж">Ж</option>
            </select>
        </div>
    </div>

    <div class="w3-row w3-margin">
        <div>
            <button class="w3-button w3-dark-gray w3-right" type="submit">Поиск <i
                    class="fa fa-search"></i></button>
        </div>
        <a class="w3-button w3-dark-gray w3-right w3-margin-right" th:href="@{/patients/reset}">
            Очистить <i class="fa fa-trash"></i>
        </a>
    </div>
</form>

</body>
</html>